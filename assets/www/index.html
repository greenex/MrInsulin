<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>ListApp</title>
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<meta charset="UTF-8">
		<meta name="format-detection" content="telephone-no">
		<meta name="viewport" content="user-scalable=no, initial-scale=1, minimum-scale=1, maximum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi">
		<link rel="stylesheet" href="rtl.jquery.mobile-1.3.0.min.css" />
		<link rel="stylesheet" href="css/index.css" />
		<script src="jquery.js"></script>
		<script src="rtl.jquery.mobile-1.3.0.min.js"></script>
		<script src="cordova.js"></script>

		<script type="text/javascript" charset="utf-8">
			// Wait for Cordova to load
			//
			document.addEventListener("deviceready", onDeviceReady, false);
			var db = window.openDatabase("Database", "1.0", "Cordova Demo", 200000);
			// Cordova is ready
			//

			function onDeviceReady() {
				db.transaction(checkuser, errorCB);
				//db.transaction(checkuser, errorCB, successCB);
			}

			function addinfo() {
				db.transaction(populateDB, errorCB);
				//db.transaction(populateDB, errorCB, successCB);
			}

			// Populate the database
			//

			function addsize() {
				
				db.transaction(addsizedb, errorCB);
			}

			function addsizedb(tx) {
				//alert($("#texttime").val());
				if ($("#textsize").val() == "" || $("#texttime").val() == "" || $("#cominnts").val() == "") {
					alert("الرجاء ادخال جميع البيانات المطلوبة");
				} else {
					var today = new Date();
					var dd = today.getDate();
					var mm = today.getMonth() + 1;
					//January is 0!

					var yyyy = today.getFullYear();
					if (dd < 10) {
						dd = '0' + dd
					}
					if (mm < 10) {
						mm = '0' + mm
					}
					today = mm + '/' + dd + '/' + yyyy;
					
					tx.executeSql('INSERT INTO insulin_sizes (size,time,info,sent,date) VALUES ("' + $("#textsize").val() + '","' + $("#texttime").val() + '","' + $("#cominnts").val() + '","0","' + today + '")');
					view_size();
					alert("تم ادخال البيانات بنجاح");

				}
			}

			function populateDB(tx) {
				//alert($("#name").val());
				//alert($("#name").val()+" "+ $("#age").val()+" "+ $("#weight").val()+" "+$("#length").val()+" "+$("#email").val()+" "+$("#dr_email").val()+" "+$("#pass").val());

				if ($("#name").val() == "" || $("#age").val() == "" || $("#weight").val() == "" || $("#length").val() == "" || $("#email").val() == "" || $("#dr_email").val() == "" || $("#pass").val() == "") {
					alert("الرجاء ادخال جميع البيانات المطلوبة");
				} else {
					tx.executeSql('CREATE TABLE IF NOT EXISTS insulin_sizes (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT , size TEXT , time TEXT , info TEXT , sent TEX, date TEXT)');
					tx.executeSql('CREATE TABLE IF NOT EXISTS user_info (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT , name TEXT , age TEXT , length TEXT , weight TEXT , email TEXT , dr_email TEXT , password TEXT)');
					tx.executeSql('INSERT INTO user_info (name,age,weight,length,email,dr_email,password) VALUES ("' + $("#name").val() + '","' + $("#age").val() + '","' + $("#weight").val() + '","' + $("#length").val() + '","' + $("#email").val() + '","' + $("#dr_email").val() + '","' + $("#pass").val() + '")');
					alert("تم ادخال البيانات بنجاح");
					$("#info").hide();
					$("#icons").show();
				}
			}

			function checkuser(tx) {
				//alert("check user!");
				//tx.executeSql('DROP TABLE IF EXISTS user_info;');
				tx.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name='user_info'", [], function(tx, result) {
					if (result.rows.length == 0) {
						//	alert("not excet");
						$("#info").show();
					} else {
						$("#icons").show();

					}
				});
			}

			// Transaction error callback
			//
			function errorCB(tx, err) {
				alert("Error processing SQL: " + err);
			}

			// Transaction success callback
			//
			function successCB() {
				//alert("success!");
				db.transaction(queryDB, errorCB);
			}

			function runadd() {
				//alert("rub add!");
				db.transaction(addrow, errorCB);
			}

			function queryDB(tx) {
			//	alert("select data!");
				tx.executeSql('SELECT * FROM user_info', [], querySuccess, errorCB);
			}

			function view_size() {
				db.transaction(getsizes, errorCB);
				var data='';
			}

			function getsizes(tx) {
				//alert("select data!");
				
				tx.executeSql('SELECT * FROM insulin_sizes', [], querysizes, errorCB);
				
			}

			function querysizes(tx, result) {
				//alert("goo");
				$('#viewallsizes').empty();
				$('#texttime').empty();
				var myitems = new Array();
				for (var i = 0; i < result.rows.length; i++) {
					var timedata='';
					if(result.rows.item(i).time==1){
						timedata='قبل الافطار ';
					}else if(result.rows.item(i).time==2){
						timedata='بعد الافطار ';
					}else if(result.rows.item(i).time==3){
						timedata='قبل الغداء ';
					}
					else if(result.rows.item(i).time==4){
						timedata='بعد الغداء ';
					}else if(result.rows.item(i).time==5){
						timedata='قبل العشاء ';
					}
					else if(result.rows.item(i).time==6){
						timedata='بعد العشاء ';
					}else{
						timedata='وقت اخر ';
					}
					$('#viewallsizes').append('<li><a href="#"><h3 class="ui-li-heading">' + result.rows.item(i).date + '</h3><p class="ui-li-desc"><h4>' + timedata + '</h4></p></a></li>');
					
					
					myitems.push(result.rows.item(i).time);
					//alert(result.rows.item(i).time);
					//s += "<li><a href='edit.html?id=" + results.rows.item(i).id + "'>" + results.rows.item(i).title + "</a></li>";
				}
				$('#texttime').append('<option value=""></option>');
				var fruits = [ "قبل الافطار", "بعد الافطار ", "قبل الغداء", "بعد الغداء", "قبل العشاء ", "بعد العشاء"];
				//alert(myitems.length);
				for (var i=0; i <= 5; i++) {
					var num=i+1;
					if(myitems.indexOf(num+"")==-1){
					//	alert(i);
						$('#texttime').append('<option value="'+num+'">'+fruits[i]+'</option>');
					}else{
						//alert(i);
						$('#texttime').append('<option value="'+num+'" disabled="true">'+fruits[i]+'</option>');
					}
				  fruits[i]
				}
				$('#texttime').append('<option value="7">وقت اخر</option>');
				$("#texttime").trigger('create');
				$('#texttime').content('refresh');
				$("#viewallsizes").trigger('create');
				$('#viewallsizes').listview('refresh');
					
			}

			function querySuccess(tx, result) {
				//alert("goo");
				$('#SoccerPlayerList').empty();
				for (var i = 0; i < result.rows.length; i++) {
					$('#SoccerPlayerList').append('<li><a href="#"><h3 class="ui-li-heading">' + result.rows.item(i).id + '</h3><p class="ui-li-desc"> ' + result.rows.item(i).name + '</p></a></li>');

					//s += "<li><a href='edit.html?id=" + results.rows.item(i).id + "'>" + results.rows.item(i).title + "</a></li>";
				}
				$('#SoccerPlayerList').listview();
				
			}

		</script>

	</head>
	<body>

		<div data-role="page" id="home">
			<div data-role="header" data-position="fixed" data-theme="b">
				<h1>القائمة الرئيسي</h1>
			</div>
			<div data-role="content">
				<table width="100%" style="display: none;" id="info">
					<tr>
						<td>الاسم</td><td>
						<input type="text" id="name" />
						</td>
					</tr>
					<tr>
						<td>العمر</td><td>
						<input type="text" id="age" />
						</td>
					</tr>
					<tr>
						<td>الوزن</td><td>
						<input type="text" id="weight" />
						</td>
					</tr>
					<tr>
						<td>الطول</td><td>
						<input type="text" id="length" />
						</td>
					</tr>
					<tr>
						<td>البريد الالكتروني</td><td>
						<input type="text" id="email" />
						</td>
					</tr>
					<tr>
						<td>كلمة السر </td><td>
						<input type="text" id="pass" />
						</td>
					</tr>
					<tr>
						<td>البريد الالكتروني للدكتور</td><td>
						<input type="text" id="dr_email" />
						</td>
					</tr>
					<tr>
						<td colspan="2">
						<input type="button"  id="add" onclick="addinfo();" value="ادخال"/>
						</td>
					</tr>
				</table>

				<table width="100%" class="tablestyle"  style="display: none;" id="icons">
					<tr>
						<td class="iconstyle"><a href="#newsize" class="linktag" onclick="view_size()"><img src="icons/chart.png" width="60"  />
						<br />
						قياسات السكر</a></td>
						<td class="iconstyle"><a href="#newsize" class="linktag"><img src="icons/Alarm.png" width="60" />
						<br />
						المنبة</a></td>
						<td class="iconstyle"><a href="#news" class="linktag"><img src="icons/food.png" width="60"  />
						<br />
						أكلات مفيدة </a></td>
					</tr>
					<tr>
						<td class="iconstyle"><a href="#news" class="linktag"><img src="icons/sport.png" width="60"  />
						<br />
						رياضة</a></td>
						<td class="iconstyle"><a href="#news" class="linktag"><img src="icons/info.png" width="60" />
						<br />
						نصائح عامة </a></td>
						<td class="iconstyle"><a href="#news" class="linktag"><img src="icons/questions.png" width="60" />
						<br />
						اسئلة شائعة </a></td>
					</tr>
					<tr>
						<td class="iconstyle"><a href="#news" class="linktag"><img src="icons/contact.png" width="60"  />
						<br />
						تواصل معنا </a></td>
					</tr>

				</table>
			</div>
		</div>

		<div id="newsize" data-role="page">
			<header data-role="header">
				<h1>القياسات</h1>
				<a href="#home" data-icon="back" data-iconpos="notext">القياسات</a>
				<nav data-role="navbar">
					<ul>
						<li>
							<a href="#newsize">جديد</a>
						</li>
						<li>
							<a href="#allsizesdata">عرض</a>
						</li>
					</ul>
				</nav>
			</header>
			<div data-role="content">
				<div id='addnewsize'>
					<table width="100%">
						<tr>
							<td>القياس</td><td>
							<input type="text" id="textsize" />
							ملجم⁄ دسل </td>
						</tr>
						<tr>
							<td>الوقت</td><td>
							<select id="texttime">
								<option value="0"> </option>
								<option value="1" disabled="true">قبل الافطار</option>
								<option value="2">بعد الافطار </option>
								<option value="3">قبل الغداء </option>
								<option value="4">بعد الغداء </option>
								<option value="5">قبل العشاء </option>
								<option value="6">بعد العشاء </option>
								<option value="7">وقت اخر</option>
							</select></td>
						</tr>
						<tr>
							<td>ملاحضة</td><td><textarea id="cominnts"></textarea></td>
						</tr>
						<tr>
							<td colspan="2">
							<input type="button" onclick="addsize();" value="ادخل" />
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>

		<div id="allsizesdata" data-role="page">
			<header data-role="header">
				<h1>القياسات</h1>
				<a href="#home" data-icon="back" data-iconpos="notext">القياسات</a>
				<nav data-role="navbar">
					<ul>
						<li>
							<a href="#newsize">جديد</a>
						</li>
						<li>
							<a href="#allsizesdata">عرض</a>
						</li>
					</ul>
				</nav>
			</header>
			<div data-role="content">
				<ul data-role="listview"   data-filter="true" id='viewallsizes'>
					<li>
						tedt
					</li>
				</ul>
			</div>

		</div>
	</body>
</html>